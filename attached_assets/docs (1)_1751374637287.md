# Cryptix API Documentation

## Base URL
- `https://cryptix-api.vercel.app`
- account needs to be activated to use authorization reliant endpoints other than login. (returns 403 status code if unactivated)
  
## Authentication Routes (`/api/v1/users`)

### POST /register
Register a new user using Discord OAuth2.

**Request Body:**
```json
{
  "code": "discord_authorization_code"
}
```

**Response:**
```json
{
  "success": true,
  "token": "jwt_token_here",
  "customer": {
    "id": "user_id",
    "discord_id": "discord_user_id",
    "activated": false,
    "createdAt": "2024-01-01T00:00:00.000Z"
  },
  "password": "abc123XY"
}
```

**Note:** The `password` field is only returned for new user registrations, not for existing users.

**Rate Limit:** 5 requests per 15 minutes

**Error Responses:**
- `400`: Invalid authorization code or missing email
- `409`: Email already exists
- `500`: Registration failed

### POST /login
Login with Discord ID and password.

**Request Body:**
```json
{
  "discord_id": "your_discord_id",
  "password": "your_password"
}
```

**Response:**
```json
{
  "success": true,
  "token": "jwt_token_here",
  "customer": {
    "id": "user_id",
    "discord_id": "your_discord_id",
    "activated": false,
    "createdAt": "2024-01-01T00:00:00.000Z"
  }
}
```

**Rate Limit:** 5 requests per 15 minutes

**Error Responses:**
- `401`: Invalid credentials
- `500`: Login failed

### GET /profile
Get current user profile information.

**Headers:**
```
Authorization: Bearer your_jwt_token
```

**Response:**
```json
{
  "success": true,
  "customer": {
    "id": "user_id",
    "discord_id": "discord_user_id",
    "activated": false,
    "createdAt": "2024-01-01T00:00:00.000Z"
  }
}
```

**Error Responses:**
- `401`: Invalid or missing token
- `403`: Token expired 

## Scripthub Routes (`/api/v1`)

All scripthub routes require authentication via Bearer token in the Authorization header.

### POST /scripthub
Create a new scripthub.

**Headers:**
```
Authorization: Bearer your_jwt_token
```

**Request Body:**
```json
{
  "name": "scripthub_name",
  "checkpoints": 1
}
```

**Response:**
```json
{
  "success": true,
  "message": "Scripthub created successfully",
  "scripthub": {
    "name": "scripthub_name",
    "token": "generated_token",
    "max_keys": 2000,
    "key_timelimit": 16,
    "maxCheckpoints": 10,
    "checkpoints": 1,
    "cryptixCheckpoint": 1,
    "checkpointData": {
      "linkvertise": {
        "public_token": "token"
      },
      "lootlabs": {
        "public_token": "token"
      }
    },
    "keys": {}
  }
}
```

**Rate Limit:** 3 requests per 5 minutes

**Error Responses:**
- `400`: Invalid scripthub name or checkpoints
- `409`: Scripthub limit reached or name already exists
- `500`: Creation failed

### GET /scripthub
Get all scripthubs for the authenticated user.

**Headers:**
```
Authorization: Bearer your_jwt_token
```

**Response:**
```json
{
  "success": true,
  "scripthubs": [
    {
      "name": "scripthub_name",
      "token": "scripthub_token",
      "max_keys": 2000,
      "current_keys": 0,
      "key_timelimit": 16,
      "maxCheckpoints": 10,
      "checkpoints": 1,
      "cryptixCheckpoint": 1,
      "checkpointData": {
        "linkvertise": {
          "public_token": "token"
        },
        "lootlabs": {
          "public_token": "token"
        }
      }
    }
  ],
  "limits": {
    "max_scripthubs": 1,
    "max_keys": 200
  }
}
```

**Rate Limit:** 10 requests per minute

### PUT /scripthub/{scripthub_name}
Update an existing scripthub.

**Headers:**
```
Authorization: Bearer your_jwt_token
```

**Request Body:**
```json
{
  "new_name": "new_scripthub_name",
  "key_timelimit": 24,
  "checkpoints": 2
}
```

**Response:**
```json
{
  "success": true,
  "message": "Scripthub updated successfully",
  "scripthub": {
    // Updated scripthub object
  }
}
```

**Rate Limit:** 5 requests per minute

**Error Responses:**
- `400`: Invalid update data
- `404`: Scripthub not found
- `409`: New name already exists
- `500`: Update failed

### DELETE /scripthub/{scripthub_name}
Delete a scripthub.

**Headers:**
```
Authorization: Bearer your_jwt_token
```

**Response:**
```json
{
  "success": true,
  "message": "Scripthub deleted successfully",
  "scripthub": {}
}
```

**Rate Limit:** 3 requests per 5 minutes

**Error Responses:**
- `404`: Scripthub not found
- `500`: Deletion failed

## Discord OAuth2 Flow

1. **Frontend**: Redirect user to Discord OAuth2 URL with your client ID
2. **Discord**: User authorizes and redirects back to `https://cryptix-sigma.vercel.app/callback` with authorization code
3. **Frontend**: Send the authorization code to `/api/v1/users/register`
4. **Backend**: Exchange code for Discord access token, fetch user info, create/login user
5. **Response**: Return JWT token for subsequent API calls

## Error Handling

All endpoints return consistent error responses:

```json
{
  "detail": "Error message description"
}
```

Common HTTP status codes:
- `400`: Bad Request (invalid input)
- `401`: Unauthorized (missing/invalid token)
- `403`: Forbidden (token expired)
- `404`: Not Found
- `409`: Conflict (resource already exists)
- `429`: Too Many Requests (rate limit exceeded)
- `500`: Internal Server Error

## Rate Limiting

Rate limits are applied per IP address:
- Registration: 5 requests per 15 minutes
- Login: 5 requests per 15 minutes
- Scripthub creation: 3 requests per 5 minutes
- Scripthub listing: 10 requests per minute
- Scripthub updates: 5 requests per minute
- Scripthub deletion: 3 requests per 5 minutes

When rate limit is exceeded, you'll receive a `429` status code.